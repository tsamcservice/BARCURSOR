<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>卡片即時預覽測試</title>
  <script src="/data/common.js"></script>
  <script src="/data/data.js"></script>
  <link rel="stylesheet" type="text/css" href="/data/styles.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/PamornT/flex2html@main/css/flex2html.css" />
  <script src="https://cdn.jsdelivr.net/gh/PamornT/flex2html@main/js/flex2html.min.js"></script>
  <style>
    .test-flex-row { display: flex; gap: 40px; align-items: flex-start; margin: 40px 0; }
    .test-flex-col { flex: 1; min-width: 320px; }
    .test-preview-box { background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #0001; padding: 20px; }
    .test-title { font-size: 1.5em; margin-bottom: 20px; }
    #test { white-space: pre-wrap; background: #f5f5f5; padding: 10px; border-radius: 4px; margin-top: 10px; font-size: 0.95em; }
  </style>
</head>
<body>
  <div class="test-flex-row">
    <div class="test-flex-col">
      <div class="form-container">
        <div class="test-title">卡片欄位編輯</div>
        <div class="form-group">
          <label>主標1</label>
          <input id="mainTitle_1" type="text" style="width:100%" />
        </div>
        <div class="form-group">
          <label>主標2</label>
          <textarea id="mainTitle_2" style="width:100%;height:40px;resize:none;"></textarea>
        </div>
        <div class="form-group">
          <label>按鈕1</label>
          <input id="textContent_2" type="text" style="width:100%" />
        </div>
        <div class="form-group">
          <label>按鈕1 URL</label>
          <input id="textContent_2_url" type="text" style="width:100%" />
        </div>
        <div class="form-group">
          <label>使用者名稱</label>
          <input id="displayName" type="text" style="width:100%" />
        </div>
        <div class="form-group">
          <label>使用者按鈕 URL</label>
          <input id="subTitle_2" type="text" style="width:100%" />
        </div>
        <div class="form-group">
          <label>使用者圖像 URL</label>
          <input id="textContent_1" type="text" style="width:100%" />
        </div>
        <div class="form-group">
          <label>大圖 URL</label>
          <input id="textContent_1_url" type="text" style="width:100%" />
        </div>
        <div class="form-group">
          <label>文字顏色</label>
          <input id="textColor" type="text" style="width:100%" />
        </div>
      </div>
    </div>
    <div class="test-flex-col">
      <div class="test-preview-box">
        <div class="test-title">即時預覽</div>
        <div id="flex2html_main"></div>
        <div id="test"></div>
      </div>
    </div>
  </div>
  <script>
    // 初始化欄位預設值
    window.addEventListener('DOMContentLoaded', async function() {
      window.userId = 'test_user';
      window.displayName = '測試用戶';
      try {
        const response = await sendRequest("get", window.userId);
        if (response && response.status === "ok" && response.cardJson && response.cardJson.length > 0) {
          window.flexJsonStatic = response.cardJson[0];
        }
      } catch (error) {
        console.error('取得卡片代碼失敗:', error);
      }
      // 欄位變動即時渲染
      const fields = ['mainTitle_1','mainTitle_2','textContent_2','textContent_2_url','displayName','subTitle_2','textContent_1','textContent_1_url','textColor'];
      fields.forEach(id => {
        document.addEventListener('input', function(e) {
          if(e.target && e.target.id === id) renderPreview();
        });
      });
      renderPreview();
    });
    function renderPreview() {
      window.mainTitle_1 = document.getElementById('mainTitle_1').value;
      window.mainTitle_2 = document.getElementById('mainTitle_2').value;
      window.textContent_2 = document.getElementById('textContent_2').value;
      window.textContent_2_url = document.getElementById('textContent_2_url').value;
      window.displayName = document.getElementById('displayName').value;
      window.subTitle_2 = document.getElementById('subTitle_2').value;
      window.textContent_1 = document.getElementById('textContent_1').value;
      window.textContent_1_url = document.getElementById('textContent_1_url').value;
      window.textColor = document.getElementById('textColor').value;
      const flexJsonList = createFlexJsonList();
      my_flexToHtml('flex2html_main', flexJsonList);
    }
  </script>
</body>
</html> 